import { __decorate } from "tslib";
import { ChangeDetectionStrategy, Component, ElementRef, Input, OnChanges, Renderer2, ViewChild } from '@angular/core';
import QRCode from 'qrcode';
import { NgxQrcodeElementTypes } from './qrcode.types';
import { DEFAULT_VALUES } from './qrcode.constants';
import * as ɵngcc0 from '@angular/core';

const _c0 = ["qrcElement"];
let QrcodeComponent = class QrcodeComponent {
    constructor(renderer) {
        this.renderer = renderer;
        this.elementType = DEFAULT_VALUES.elementType;
        this.cssClass = DEFAULT_VALUES.cssClass;
        this.value = DEFAULT_VALUES.value;
        this.version = DEFAULT_VALUES.version;
        this.errorCorrectionLevel = DEFAULT_VALUES.errorCorrectionLevel;
        this.margin = DEFAULT_VALUES.margin;
        this.scale = DEFAULT_VALUES.scale;
        this.width = DEFAULT_VALUES.width;
        this.colorDark = DEFAULT_VALUES.colorDark;
        this.colorLight = DEFAULT_VALUES.colorLight;
    }
    ngOnChanges() {
        this.createQRCode();
    }
    createQRCode() {
        if (!this.value) {
            return;
        }
        let element;
        switch (this.elementType) {
            case NgxQrcodeElementTypes.CANVAS:
                element = this.renderer.createElement('canvas');
                this.toCanvas(element).then(() => {
                    this.renderElement(element);
                }).catch(e => {
                    this.removeElementChildren();
                    console.error(e);
                });
                break;
            default:
                element = this.renderer.createElement('img');
                this.toDataURL().then((src) => {
                    element.setAttribute('src', src);
                    if (this.alt) {
                        element.setAttribute('alt', this.alt);
                    }
                    this.renderElement(element);
                }).catch(e => {
                    this.removeElementChildren();
                    console.error(e);
                });
        }
    }
    toDataURL() {
        return QRCode.toDataURL(this.value, {
            version: this.version,
            errorCorrectionLevel: this.errorCorrectionLevel,
            margin: this.margin,
            scale: this.scale,
            width: this.width,
            color: {
                dark: this.colorDark,
                light: this.colorLight
            }
        });
    }
    toCanvas(canvas) {
        return QRCode.toCanvas(canvas, this.value, {
            version: this.version,
            errorCorrectionLevel: this.errorCorrectionLevel,
            margin: this.margin,
            scale: this.scale,
            width: this.width,
            color: {
                dark: this.colorDark,
                light: this.colorLight
            }
        });
    }
    renderElement(element) {
        this.removeElementChildren();
        this.renderer.appendChild(this.qrcElement.nativeElement, element);
    }
    removeElementChildren() {
        for (const node of this.qrcElement.nativeElement.childNodes) {
            this.renderer.removeChild(this.qrcElement.nativeElement, node);
        }
    }
};
QrcodeComponent.ɵfac = function QrcodeComponent_Factory(t) { return new (t || QrcodeComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2)); };
QrcodeComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: QrcodeComponent, selectors: [["ngx-qrcode"]], viewQuery: function QrcodeComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(_c0, true);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.qrcElement = _t.first);
    } }, inputs: { elementType: "elementType", cssClass: "cssClass", value: "value", version: "version", errorCorrectionLevel: "errorCorrectionLevel", margin: "margin", scale: "scale", width: "width", colorDark: "colorDark", colorLight: "colorLight", alt: "alt" }, features: [ɵngcc0.ɵɵNgOnChangesFeature], decls: 2, vars: 2, consts: [["qrcElement", ""]], template: function QrcodeComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelement(0, "div", null, 0);
    } if (rf & 2) {
        ɵngcc0.ɵɵclassMap(ctx.cssClass);
    } }, encapsulation: 2, changeDetection: 0 });
QrcodeComponent.ctorParameters = () => [
    { type: Renderer2 }
];
__decorate([
    Input()
], QrcodeComponent.prototype, "elementType", void 0);
__decorate([
    Input()
], QrcodeComponent.prototype, "cssClass", void 0);
__decorate([
    Input()
], QrcodeComponent.prototype, "alt", void 0);
__decorate([
    Input()
], QrcodeComponent.prototype, "value", void 0);
__decorate([
    Input()
], QrcodeComponent.prototype, "version", void 0);
__decorate([
    Input()
], QrcodeComponent.prototype, "errorCorrectionLevel", void 0);
__decorate([
    Input()
], QrcodeComponent.prototype, "margin", void 0);
__decorate([
    Input()
], QrcodeComponent.prototype, "scale", void 0);
__decorate([
    Input()
], QrcodeComponent.prototype, "width", void 0);
__decorate([
    Input()
], QrcodeComponent.prototype, "colorDark", void 0);
__decorate([
    Input()
], QrcodeComponent.prototype, "colorLight", void 0);
__decorate([
    ViewChild('qrcElement')
], QrcodeComponent.prototype, "qrcElement", void 0);
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(QrcodeComponent, [{
        type: Component,
        args: [{
                selector: 'ngx-qrcode',
                template: `
    <div #qrcElement [class]="cssClass"></div>`,
                changeDetection: ChangeDetectionStrategy.OnPush
            }]
    }], function () { return [{ type: ɵngcc0.Renderer2 }]; }, { elementType: [{
            type: Input
        }], cssClass: [{
            type: Input
        }], value: [{
            type: Input
        }], version: [{
            type: Input
        }], errorCorrectionLevel: [{
            type: Input
        }], margin: [{
            type: Input
        }], scale: [{
            type: Input
        }], width: [{
            type: Input
        }], colorDark: [{
            type: Input
        }], colorLight: [{
            type: Input
        }], alt: [{
            type: Input
        }], qrcElement: [{
            type: ViewChild,
            args: ['qrcElement']
        }] }); })();
export { QrcodeComponent };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXJjb2RlLmNvbXBvbmVudC5qcyIsInNvdXJjZXMiOlsibmc6L25neC1xcmNvZGUyL2xpYi9xcmNvZGUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFdkgsT0FBTyxNQUFNLE1BQU0sUUFBUSxDQUFDO0FBRTVCLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQzs7OztBQVFwRCxJQUFhLGVBQWUsR0FBNUIsTUFBYSxlQUFlO0FBQUcsSUFpQjdCLFlBQW9CLFFBQW1CO0FBQ3pDLFFBRHNCLGFBQVEsR0FBUixRQUFRLENBQVc7QUFBQyxRQWYvQixnQkFBVyxHQUFHLGNBQWMsQ0FBQyxXQUFXLENBQUM7QUFDcEQsUUFBVyxhQUFRLEdBQUcsY0FBYyxDQUFDLFFBQVEsQ0FBQztBQUM5QyxRQUNXLFVBQUssR0FBRyxjQUFjLENBQUMsS0FBSyxDQUFDO0FBQ3hDLFFBQVcsWUFBTyxHQUFHLGNBQWMsQ0FBQyxPQUFPLENBQUM7QUFDNUMsUUFDVyx5QkFBb0IsR0FBRyxjQUFjLENBQUMsb0JBQW9CLENBQUM7QUFDdEUsUUFBVyxXQUFNLEdBQUcsY0FBYyxDQUFDLE1BQU0sQ0FBQztBQUMxQyxRQUFXLFVBQUssR0FBRyxjQUFjLENBQUMsS0FBSyxDQUFDO0FBQ3hDLFFBQVcsVUFBSyxHQUFHLGNBQWMsQ0FBQyxLQUFLLENBQUM7QUFDeEMsUUFBVyxjQUFTLEdBQUcsY0FBYyxDQUFDLFNBQVMsQ0FBQztBQUNoRCxRQUFXLGVBQVUsR0FBRyxjQUFjLENBQUMsVUFBVSxDQUFDO0FBQ2xELElBSUUsQ0FBQztBQUNILElBQ0UsV0FBVztBQUNiLFFBQUksSUFBSSxDQUFDLFlB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O0FBQWEsSUFBckIsS0FBSyxFQUFFO0FBQUMsa0RBQXFDO0FBQ3JDO0FBQWEsSUFBckIsS0FBSyxFQUFFO0FBQUMsbURBQXVDO0FBRXZCO0FBQWEsSUFBckMsU0FBUyxDQUFDLFlBQVksQ0FBQztBQUFDLG1EQUF1QjtBQWZyQyxlQUFlLG9CQU4zQixTQUFTLENBQUMsVUFDVCxRQUFRLEVBQUU7R0FBWSxVQUN0QixRQUFRLEVBQUU7OzhCQUNtQztBQUM3QyxlQUFlLEVBQUU7WUFBdUIsQ0FBQyxNQUFNLE1BQ2hELENBQUMsSUFDVyxlQUFlLENBZ0czQjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztvQkFDRDtBQUFDLFNBakdZLGVBQWU7QUFBSSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IENoYW5nZURldGVjdGlvblN0cmF0ZWd5LCBDb21wb25lbnQsIEVsZW1lbnRSZWYsIElucHV0LCBPbkNoYW5nZXMsIFJlbmRlcmVyMiwgVmlld0NoaWxkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmltcG9ydCBRUkNvZGUgZnJvbSAncXJjb2RlJztcblxuaW1wb3J0IHsgTmd4UXJjb2RlRWxlbWVudFR5cGVzIH0gZnJvbSAnLi9xcmNvZGUudHlwZXMnO1xuaW1wb3J0IHsgREVGQVVMVF9WQUxVRVMgfSBmcm9tICcuL3FyY29kZS5jb25zdGFudHMnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICduZ3gtcXJjb2RlJyxcbiAgdGVtcGxhdGU6IGBcbiAgICA8ZGl2ICNxcmNFbGVtZW50IFtjbGFzc109XCJjc3NDbGFzc1wiPjwvZGl2PmAsXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoXG59KVxuZXhwb3J0IGNsYXNzIFFyY29kZUNvbXBvbmVudCBpbXBsZW1lbnRzIE9uQ2hhbmdlcyB7XG5cbiAgQElucHV0KCkgZWxlbWVudFR5cGUgPSBERUZBVUxUX1ZBTFVFUy5lbGVtZW50VHlwZTtcbiAgQElucHV0KCkgY3NzQ2xhc3MgPSBERUZBVUxUX1ZBTFVFUy5jc3NDbGFzcztcbiAgQElucHV0KCkgYWx0OiBzdHJpbmc7XG4gIEBJbnB1dCgpIHZhbHVlID0gREVGQVVMVF9WQUxVRVMudmFsdWU7XG4gIEBJbnB1dCgpIHZlcnNpb24gPSBERUZBVUxUX1ZBTFVFUy52ZXJzaW9uO1xuXG4gIEBJbnB1dCgpIGVycm9yQ29ycmVjdGlvbkxldmVsID0gREVGQVVMVF9WQUxVRVMuZXJyb3JDb3JyZWN0aW9uTGV2ZWw7XG4gIEBJbnB1dCgpIG1hcmdpbiA9IERFRkFVTFRfVkFMVUVTLm1hcmdpbjtcbiAgQElucHV0KCkgc2NhbGUgPSBERUZBVUxUX1ZBTFVFUy5zY2FsZTtcbiAgQElucHV0KCkgd2lkdGggPSBERUZBVUxUX1ZBTFVFUy53aWR0aDtcbiAgQElucHV0KCkgY29sb3JEYXJrID0gREVGQVVMVF9WQUxVRVMuY29sb3JEYXJrO1xuICBASW5wdXQoKSBjb2xvckxpZ2h0ID0gREVGQVVMVF9WQUxVRVMuY29sb3JMaWdodDtcblxuICBAVmlld0NoaWxkKCdxcmNFbGVtZW50JykgcXJjRWxlbWVudDogRWxlbWVudFJlZjtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIHJlbmRlcmVyOiBSZW5kZXJlcjIpIHtcbiAgfVxuXG4gIG5nT25DaGFuZ2VzKCkge1xuICAgIHRoaXMuY3JlYXRlUVJDb2RlKCk7XG4gIH1cblxuICBjcmVhdGVRUkNvZGUoKSB7XG4gICAgaWYgKCF0aGlzLnZhbHVlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IGVsZW1lbnQ6IEVsZW1lbnQ7XG5cbiAgICBzd2l0Y2ggKHRoaXMuZWxlbWVudFR5cGUpIHtcblxuICAgICAgY2FzZSBOZ3hRcmNvZGVFbGVtZW50VHlwZXMuQ0FOVkFTOlxuICAgICAgICBlbGVtZW50ID0gdGhpcy5yZW5kZXJlci5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTtcbiAgICAgICAgdGhpcy50b0NhbnZhcyhlbGVtZW50KS50aGVuKCgpID0+IHtcbiAgICAgICAgICB0aGlzLnJlbmRlckVsZW1lbnQoZWxlbWVudCk7XG4gICAgICAgIH0pLmNhdGNoKGUgPT4ge1xuICAgICAgICAgIHRoaXMucmVtb3ZlRWxlbWVudENoaWxkcmVuKCk7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgZGVmYXVsdDpcbiAgICAgICAgZWxlbWVudCA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnaW1nJyk7XG4gICAgICAgIHRoaXMudG9EYXRhVVJMKCkudGhlbigoc3JjOiBzdHJpbmcpID0+IHtcbiAgICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnc3JjJywgc3JjKTtcbiAgICAgICAgICBpZiAodGhpcy5hbHQpIHtcbiAgICAgICAgICAgIGVsZW1lbnQuc2V0QXR0cmlidXRlKCdhbHQnLCB0aGlzLmFsdCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMucmVuZGVyRWxlbWVudChlbGVtZW50KTtcbiAgICAgICAgfSkuY2F0Y2goZSA9PiB7XG4gICAgICAgICAgdGhpcy5yZW1vdmVFbGVtZW50Q2hpbGRyZW4oKTtcbiAgICAgICAgICBjb25zb2xlLmVycm9yKGUpO1xuICAgICAgICB9KTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIHRvRGF0YVVSTCgpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIHJldHVybiBRUkNvZGUudG9EYXRhVVJMKHRoaXMudmFsdWUsXG4gICAgICB7XG4gICAgICAgIHZlcnNpb246IHRoaXMudmVyc2lvbixcbiAgICAgICAgZXJyb3JDb3JyZWN0aW9uTGV2ZWw6IHRoaXMuZXJyb3JDb3JyZWN0aW9uTGV2ZWwsXG4gICAgICAgIG1hcmdpbjogdGhpcy5tYXJnaW4sXG4gICAgICAgIHNjYWxlOiB0aGlzLnNjYWxlLFxuICAgICAgICB3aWR0aDogdGhpcy53aWR0aCxcbiAgICAgICAgY29sb3I6IHtcbiAgICAgICAgICBkYXJrOiB0aGlzLmNvbG9yRGFyayxcbiAgICAgICAgICBsaWdodDogdGhpcy5jb2xvckxpZ2h0XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSB0b0NhbnZhcyhjYW52YXMpOiBQcm9taXNlPGFueT4ge1xuICAgIHJldHVybiBRUkNvZGUudG9DYW52YXMoY2FudmFzLCB0aGlzLnZhbHVlLCB7XG4gICAgICB2ZXJzaW9uOiB0aGlzLnZlcnNpb24sXG4gICAgICBlcnJvckNvcnJlY3Rpb25MZXZlbDogdGhpcy5lcnJvckNvcnJlY3Rpb25MZXZlbCxcbiAgICAgIG1hcmdpbjogdGhpcy5tYXJnaW4sXG4gICAgICBzY2FsZTogdGhpcy5zY2FsZSxcbiAgICAgIHdpZHRoOiB0aGlzLndpZHRoLFxuICAgICAgY29sb3I6IHtcbiAgICAgICAgZGFyazogdGhpcy5jb2xvckRhcmssXG4gICAgICAgIGxpZ2h0OiB0aGlzLmNvbG9yTGlnaHRcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgcmVuZGVyRWxlbWVudChlbGVtZW50KTogdm9pZCB7XG4gICAgdGhpcy5yZW1vdmVFbGVtZW50Q2hpbGRyZW4oKTtcbiAgICB0aGlzLnJlbmRlcmVyLmFwcGVuZENoaWxkKHRoaXMucXJjRWxlbWVudC5uYXRpdmVFbGVtZW50LCBlbGVtZW50KTtcbiAgfVxuXG4gIHByaXZhdGUgcmVtb3ZlRWxlbWVudENoaWxkcmVuKCk6IHZvaWQge1xuICAgIGZvciAoY29uc3Qgbm9kZSBvZiB0aGlzLnFyY0VsZW1lbnQubmF0aXZlRWxlbWVudC5jaGlsZE5vZGVzKSB7XG4gICAgICB0aGlzLnJlbmRlcmVyLnJlbW92ZUNoaWxkKHRoaXMucXJjRWxlbWVudC5uYXRpdmVFbGVtZW50LCBub2RlKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==