import { __decorate, __values } from "tslib";
import { ChangeDetectionStrategy, Component, ElementRef, Input, OnChanges, Renderer2, ViewChild } from '@angular/core';
import QRCode from 'qrcode';
import { NgxQrcodeElementTypes } from './qrcode.types';
import { DEFAULT_VALUES } from './qrcode.constants';
import * as ɵngcc0 from '@angular/core';

var _c0 = ["qrcElement"];
var QrcodeComponent = /** @class */ (function () {
    function QrcodeComponent(renderer) {
        this.renderer = renderer;
        this.elementType = DEFAULT_VALUES.elementType;
        this.cssClass = DEFAULT_VALUES.cssClass;
        this.value = DEFAULT_VALUES.value;
        this.version = DEFAULT_VALUES.version;
        this.errorCorrectionLevel = DEFAULT_VALUES.errorCorrectionLevel;
        this.margin = DEFAULT_VALUES.margin;
        this.scale = DEFAULT_VALUES.scale;
        this.width = DEFAULT_VALUES.width;
        this.colorDark = DEFAULT_VALUES.colorDark;
        this.colorLight = DEFAULT_VALUES.colorLight;
    }
    QrcodeComponent.prototype.ngOnChanges = function () {
        this.createQRCode();
    };
    QrcodeComponent.prototype.createQRCode = function () {
        var _this = this;
        if (!this.value) {
            return;
        }
        var element;
        switch (this.elementType) {
            case NgxQrcodeElementTypes.CANVAS:
                element = this.renderer.createElement('canvas');
                this.toCanvas(element).then(function () {
                    _this.renderElement(element);
                }).catch(function (e) {
                    _this.removeElementChildren();
                    console.error(e);
                });
                break;
            default:
                element = this.renderer.createElement('img');
                this.toDataURL().then(function (src) {
                    element.setAttribute('src', src);
                    if (_this.alt) {
                        element.setAttribute('alt', _this.alt);
                    }
                    _this.renderElement(element);
                }).catch(function (e) {
                    _this.removeElementChildren();
                    console.error(e);
                });
        }
    };
    QrcodeComponent.prototype.toDataURL = function () {
        return QRCode.toDataURL(this.value, {
            version: this.version,
            errorCorrectionLevel: this.errorCorrectionLevel,
            margin: this.margin,
            scale: this.scale,
            width: this.width,
            color: {
                dark: this.colorDark,
                light: this.colorLight
            }
        });
    };
    QrcodeComponent.prototype.toCanvas = function (canvas) {
        return QRCode.toCanvas(canvas, this.value, {
            version: this.version,
            errorCorrectionLevel: this.errorCorrectionLevel,
            margin: this.margin,
            scale: this.scale,
            width: this.width,
            color: {
                dark: this.colorDark,
                light: this.colorLight
            }
        });
    };
    QrcodeComponent.prototype.renderElement = function (element) {
        this.removeElementChildren();
        this.renderer.appendChild(this.qrcElement.nativeElement, element);
    };
    QrcodeComponent.prototype.removeElementChildren = function () {
        var e_1, _a;
        try {
            for (var _b = __values(this.qrcElement.nativeElement.childNodes), _c = _b.next(); !_c.done; _c = _b.next()) {
                var node = _c.value;
                this.renderer.removeChild(this.qrcElement.nativeElement, node);
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
    };
    QrcodeComponent.ctorParameters = function () { return [
        { type: Renderer2 }
    ]; };
    __decorate([
        Input()
    ], QrcodeComponent.prototype, "elementType", void 0);
    __decorate([
        Input()
    ], QrcodeComponent.prototype, "cssClass", void 0);
    __decorate([
        Input()
    ], QrcodeComponent.prototype, "alt", void 0);
    __decorate([
        Input()
    ], QrcodeComponent.prototype, "value", void 0);
    __decorate([
        Input()
    ], QrcodeComponent.prototype, "version", void 0);
    __decorate([
        Input()
    ], QrcodeComponent.prototype, "errorCorrectionLevel", void 0);
    __decorate([
        Input()
    ], QrcodeComponent.prototype, "margin", void 0);
    __decorate([
        Input()
    ], QrcodeComponent.prototype, "scale", void 0);
    __decorate([
        Input()
    ], QrcodeComponent.prototype, "width", void 0);
    __decorate([
        Input()
    ], QrcodeComponent.prototype, "colorDark", void 0);
    __decorate([
        Input()
    ], QrcodeComponent.prototype, "colorLight", void 0);
    __decorate([
        ViewChild('qrcElement')
    ], QrcodeComponent.prototype, "qrcElement", void 0);
QrcodeComponent.ɵfac = function QrcodeComponent_Factory(t) { return new (t || QrcodeComponent)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.Renderer2)); };
QrcodeComponent.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: QrcodeComponent, selectors: [["ngx-qrcode"]], viewQuery: function QrcodeComponent_Query(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵviewQuery(_c0, true);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.qrcElement = _t.first);
    } }, inputs: { elementType: "elementType", cssClass: "cssClass", value: "value", version: "version", errorCorrectionLevel: "errorCorrectionLevel", margin: "margin", scale: "scale", width: "width", colorDark: "colorDark", colorLight: "colorLight", alt: "alt" }, features: [ɵngcc0.ɵɵNgOnChangesFeature], decls: 2, vars: 2, consts: [["qrcElement", ""]], template: function QrcodeComponent_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵelement(0, "div", null, 0);
    } if (rf & 2) {
        ɵngcc0.ɵɵclassMap(ctx.cssClass);
    } }, encapsulation: 2, changeDetection: 0 });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(QrcodeComponent, [{
        type: Component,
        args: [{
                selector: 'ngx-qrcode',
                template: "\n    <div #qrcElement [class]=\"cssClass\"></div>",
                changeDetection: ChangeDetectionStrategy.OnPush
            }]
    }], function () { return [{ type: ɵngcc0.Renderer2 }]; }, { elementType: [{
            type: Input
        }], cssClass: [{
            type: Input
        }], value: [{
            type: Input
        }], version: [{
            type: Input
        }], errorCorrectionLevel: [{
            type: Input
        }], margin: [{
            type: Input
        }], scale: [{
            type: Input
        }], width: [{
            type: Input
        }], colorDark: [{
            type: Input
        }], colorLight: [{
            type: Input
        }], alt: [{
            type: Input
        }], qrcElement: [{
            type: ViewChild,
            args: ['qrcElement']
        }] }); })();
    return QrcodeComponent;
}());
export { QrcodeComponent };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicXJjb2RlLmNvbXBvbmVudC5qcyIsInNvdXJjZXMiOlsibmc6L25neC1xcmNvZGUyL2xpYi9xcmNvZGUuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUUsdUJBQXVCLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsTUFBTSxlQUFlLENBQUM7QUFFdkgsT0FBTyxNQUFNLE1BQU0sUUFBUSxDQUFDO0FBRTVCLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3ZELE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQzs7OztBQVFwRDtBQUFtRCxJQWlCakQseUJBQW9CLFFBQW1CO0FBQ3pDLFFBRHNCLGFBQVEsR0FBUixRQUFRLENBQVc7QUFBQyxRQWYvQixnQkFBVyxHQUFHLGNBQWMsQ0FBQyxXQUFXLENBQUM7QUFDcEQsUUFBVyxhQUFRLEdBQUcsY0FBYyxDQUFDLFFBQVEsQ0FBQztBQUM5QyxRQUNXLFVBQUssR0FBRyxjQUFjLENBQUMsS0FBSyxDQUFDO0FBQ3hDLFFBQVcsWUFBTyxHQUFHLGNBQWMsQ0FBQyxPQUFPLENBQUM7QUFDNUMsUUFDVyx5QkFBb0IsR0FBRyxjQUFjLENBQUMsb0JBQW9CLENBQUM7QUFDdEUsUUFBVyxXQUFNLEdBQUcsY0FBYyxDQUFDLE1BQU0sQ0FBQztBQUMxQyxRQUFXLFVBQUssR0FBRyxjQUFjLENBQUMsS0FBSyxDQUFDO0FBQ3hDLFFBQVcsVUFBSyxHQUFHLGNBQWMsQ0FBQyxLQUFLLENBQUM7QUFDeEMsUUFBVyxjQUFTLEdBQUcsY0FBYyxDQUFDLFNBQVMsQ0FBQztBQUNoRCxRQUFXLGVBQVUsR0FBRyxjQUFjLENBQUMsVUFBVSxDQUFDO0FBQ2xELElBSUUsQ0FBQztBQUNILElBQ0UscUNBQVcsR0FBWDtBQUFjLFFBQ1osSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO0FBQ3hC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LFFBQXJCLEtBQUssRUFBRTtBQUFDLG1EQUErQjtBQUN6QyxJQUFVO0FBQWEsUUFBckIsS0FBSyxFQUFFO0FBQUMsa0RBQTZCO0FBQ3ZDLElBQVU7QUFBYSxRQUFyQixLQUFLLEVBQUU7QUFBQyxrREFBNkI7QUFDdkMsSUFBVTtBQUFhLFFBQXJCLEtBQUssRUFBRTtBQUFDLHNEQUFxQztBQUMvQyxJQUFVO0FBQWEsUUFBckIsS0FBSyxFQUFFO0FBQUMsdURBQXVDO0FBRWxELElBQTJCO0FBQWEsUUFBckMsU0FBUyxDQUFDLFlBQVksQ0FBQztBQUFDLHVEQUF1QjtJQWZyQyxlQUFlLHdCQU4zQixTQUFTLENBQUMsY0FDVCxRQUFRLEVBQUUsWUFBWSxjQUN0QixRQUFRLEVBQUU7c0JBQ21DLGNBQzdDLGVBQWUsRUFBRSx1QkFBdUIsQ0FBQyxNQUFNLFVBQ2hELENBQUMsUUFDVyxlQUFlLENBZ0czQjs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O29CQUNEO0FBQUMsSUFERCxzQkFBQztBQUNBLENBREEsQUFoR0QsSUFnR0M7QUFDRCxTQWpHYSxlQUFlO0FBQUkiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSwgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBJbnB1dCwgT25DaGFuZ2VzLCBSZW5kZXJlcjIsIFZpZXdDaGlsZCB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuXG5pbXBvcnQgUVJDb2RlIGZyb20gJ3FyY29kZSc7XG5cbmltcG9ydCB7IE5neFFyY29kZUVsZW1lbnRUeXBlcyB9IGZyb20gJy4vcXJjb2RlLnR5cGVzJztcbmltcG9ydCB7IERFRkFVTFRfVkFMVUVTIH0gZnJvbSAnLi9xcmNvZGUuY29uc3RhbnRzJztcblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnbmd4LXFyY29kZScsXG4gIHRlbXBsYXRlOiBgXG4gICAgPGRpdiAjcXJjRWxlbWVudCBbY2xhc3NdPVwiY3NzQ2xhc3NcIj48L2Rpdj5gLFxuICBjaGFuZ2VEZXRlY3Rpb246IENoYW5nZURldGVjdGlvblN0cmF0ZWd5Lk9uUHVzaFxufSlcbmV4cG9ydCBjbGFzcyBRcmNvZGVDb21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMge1xuXG4gIEBJbnB1dCgpIGVsZW1lbnRUeXBlID0gREVGQVVMVF9WQUxVRVMuZWxlbWVudFR5cGU7XG4gIEBJbnB1dCgpIGNzc0NsYXNzID0gREVGQVVMVF9WQUxVRVMuY3NzQ2xhc3M7XG4gIEBJbnB1dCgpIGFsdDogc3RyaW5nO1xuICBASW5wdXQoKSB2YWx1ZSA9IERFRkFVTFRfVkFMVUVTLnZhbHVlO1xuICBASW5wdXQoKSB2ZXJzaW9uID0gREVGQVVMVF9WQUxVRVMudmVyc2lvbjtcblxuICBASW5wdXQoKSBlcnJvckNvcnJlY3Rpb25MZXZlbCA9IERFRkFVTFRfVkFMVUVTLmVycm9yQ29ycmVjdGlvbkxldmVsO1xuICBASW5wdXQoKSBtYXJnaW4gPSBERUZBVUxUX1ZBTFVFUy5tYXJnaW47XG4gIEBJbnB1dCgpIHNjYWxlID0gREVGQVVMVF9WQUxVRVMuc2NhbGU7XG4gIEBJbnB1dCgpIHdpZHRoID0gREVGQVVMVF9WQUxVRVMud2lkdGg7XG4gIEBJbnB1dCgpIGNvbG9yRGFyayA9IERFRkFVTFRfVkFMVUVTLmNvbG9yRGFyaztcbiAgQElucHV0KCkgY29sb3JMaWdodCA9IERFRkFVTFRfVkFMVUVTLmNvbG9yTGlnaHQ7XG5cbiAgQFZpZXdDaGlsZCgncXJjRWxlbWVudCcpIHFyY0VsZW1lbnQ6IEVsZW1lbnRSZWY7XG5cbiAgY29uc3RydWN0b3IocHJpdmF0ZSByZW5kZXJlcjogUmVuZGVyZXIyKSB7XG4gIH1cblxuICBuZ09uQ2hhbmdlcygpIHtcbiAgICB0aGlzLmNyZWF0ZVFSQ29kZSgpO1xuICB9XG5cbiAgY3JlYXRlUVJDb2RlKCkge1xuICAgIGlmICghdGhpcy52YWx1ZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGxldCBlbGVtZW50OiBFbGVtZW50O1xuXG4gICAgc3dpdGNoICh0aGlzLmVsZW1lbnRUeXBlKSB7XG5cbiAgICAgIGNhc2UgTmd4UXJjb2RlRWxlbWVudFR5cGVzLkNBTlZBUzpcbiAgICAgICAgZWxlbWVudCA9IHRoaXMucmVuZGVyZXIuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgICAgIHRoaXMudG9DYW52YXMoZWxlbWVudCkudGhlbigoKSA9PiB7XG4gICAgICAgICAgdGhpcy5yZW5kZXJFbGVtZW50KGVsZW1lbnQpO1xuICAgICAgICB9KS5jYXRjaChlID0+IHtcbiAgICAgICAgICB0aGlzLnJlbW92ZUVsZW1lbnRDaGlsZHJlbigpO1xuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZSk7XG4gICAgICAgIH0pO1xuICAgICAgICBicmVhaztcbiAgICAgIGRlZmF1bHQ6XG4gICAgICAgIGVsZW1lbnQgPSB0aGlzLnJlbmRlcmVyLmNyZWF0ZUVsZW1lbnQoJ2ltZycpO1xuICAgICAgICB0aGlzLnRvRGF0YVVSTCgpLnRoZW4oKHNyYzogc3RyaW5nKSA9PiB7XG4gICAgICAgICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ3NyYycsIHNyYyk7XG4gICAgICAgICAgaWYgKHRoaXMuYWx0KSB7XG4gICAgICAgICAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnYWx0JywgdGhpcy5hbHQpO1xuICAgICAgICAgIH1cbiAgICAgICAgICB0aGlzLnJlbmRlckVsZW1lbnQoZWxlbWVudCk7XG4gICAgICAgIH0pLmNhdGNoKGUgPT4ge1xuICAgICAgICAgIHRoaXMucmVtb3ZlRWxlbWVudENoaWxkcmVuKCk7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihlKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSB0b0RhdGFVUkwoKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICByZXR1cm4gUVJDb2RlLnRvRGF0YVVSTCh0aGlzLnZhbHVlLFxuICAgICAge1xuICAgICAgICB2ZXJzaW9uOiB0aGlzLnZlcnNpb24sXG4gICAgICAgIGVycm9yQ29ycmVjdGlvbkxldmVsOiB0aGlzLmVycm9yQ29ycmVjdGlvbkxldmVsLFxuICAgICAgICBtYXJnaW46IHRoaXMubWFyZ2luLFxuICAgICAgICBzY2FsZTogdGhpcy5zY2FsZSxcbiAgICAgICAgd2lkdGg6IHRoaXMud2lkdGgsXG4gICAgICAgIGNvbG9yOiB7XG4gICAgICAgICAgZGFyazogdGhpcy5jb2xvckRhcmssXG4gICAgICAgICAgbGlnaHQ6IHRoaXMuY29sb3JMaWdodFxuICAgICAgICB9XG4gICAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgdG9DYW52YXMoY2FudmFzKTogUHJvbWlzZTxhbnk+IHtcbiAgICByZXR1cm4gUVJDb2RlLnRvQ2FudmFzKGNhbnZhcywgdGhpcy52YWx1ZSwge1xuICAgICAgdmVyc2lvbjogdGhpcy52ZXJzaW9uLFxuICAgICAgZXJyb3JDb3JyZWN0aW9uTGV2ZWw6IHRoaXMuZXJyb3JDb3JyZWN0aW9uTGV2ZWwsXG4gICAgICBtYXJnaW46IHRoaXMubWFyZ2luLFxuICAgICAgc2NhbGU6IHRoaXMuc2NhbGUsXG4gICAgICB3aWR0aDogdGhpcy53aWR0aCxcbiAgICAgIGNvbG9yOiB7XG4gICAgICAgIGRhcms6IHRoaXMuY29sb3JEYXJrLFxuICAgICAgICBsaWdodDogdGhpcy5jb2xvckxpZ2h0XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBwcml2YXRlIHJlbmRlckVsZW1lbnQoZWxlbWVudCk6IHZvaWQge1xuICAgIHRoaXMucmVtb3ZlRWxlbWVudENoaWxkcmVuKCk7XG4gICAgdGhpcy5yZW5kZXJlci5hcHBlbmRDaGlsZCh0aGlzLnFyY0VsZW1lbnQubmF0aXZlRWxlbWVudCwgZWxlbWVudCk7XG4gIH1cblxuICBwcml2YXRlIHJlbW92ZUVsZW1lbnRDaGlsZHJlbigpOiB2b2lkIHtcbiAgICBmb3IgKGNvbnN0IG5vZGUgb2YgdGhpcy5xcmNFbGVtZW50Lm5hdGl2ZUVsZW1lbnQuY2hpbGROb2Rlcykge1xuICAgICAgdGhpcy5yZW5kZXJlci5yZW1vdmVDaGlsZCh0aGlzLnFyY0VsZW1lbnQubmF0aXZlRWxlbWVudCwgbm9kZSk7XG4gICAgfVxuICB9XG59XG4iXX0=